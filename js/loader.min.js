var mesh,ringcover,ring,camera,scene,renderer,$body=document.body,$wrap=document.getElementById("wrap"),areawidth=window.innerWidth,areaheight=window.innerHeight,canvassize=500,length=30,radius=5.6,rotatevalue=.035,acceleration=0,animatestep=0,toend=!1,pi2=2*Math.PI,group=new THREE.Group;function start(){toend=!0}function back(){toend=!1}function tilt(e){group.rotation.y=.5*e}function render(){var e;animatestep=Math.max(0,Math.min(240,toend?animatestep+1:animatestep-4)),(acceleration=easing(animatestep,0,1,240))>.35&&(e=(acceleration-.35)/.65,group.rotation.y=-Math.PI/2*e,group.position.z=50*e,e=Math.max(0,(acceleration-.97)/.03),mesh.material.opacity=1-e,ringcover.material.opacity=ring.material.opacity=e,ring.scale.x=ring.scale.y=.9+.1*e),renderer.render(scene,camera)}function animate(){mesh.rotation.x+=rotatevalue+acceleration,render(),requestAnimationFrame(animate)}function easing(e,a,n,t){return(e/=t/2)<1?n/2*e*e+a:n/2*((e-=2)*e*e+2)+a}(camera=new THREE.PerspectiveCamera(65,1,1,1e4)).position.z=150,(scene=new THREE.Scene).add(group),mesh=new THREE.Mesh(new THREE.TubeGeometry(new(THREE.Curve.create(function(){},function(e){var a,n,t=length*Math.sin(pi2*e),r=radius*Math.cos(3*pi2*e);return n=e%.25-(2*(1-(n=e%.25/.25))*n*-.0185+n*n*.25),0!=Math.floor(e/.25)&&2!=Math.floor(e/.25)||(n*=-1),a=radius*Math.sin(2*pi2*(e-n)),new THREE.Vector3(t,r,a)})),200,1.1,2,!0),new THREE.MeshBasicMaterial({color:16777215})),group.add(mesh),(ringcover=new THREE.Mesh(new THREE.PlaneGeometry(50,15,1),new THREE.MeshBasicMaterial({color:13723726,opacity:0,transparent:!0}))).position.x=length+1,ringcover.rotation.y=Math.PI/2,group.add(ringcover),(ring=new THREE.Mesh(new THREE.RingGeometry(4.3,5.55,32),new THREE.MeshBasicMaterial({color:16777215,opacity:0,transparent:!0}))).position.x=length+1.1,ring.rotation.y=Math.PI/2,group.add(ring),function(){var e,a;for(a=0;a<10;a++)(e=new THREE.Mesh(new THREE.PlaneGeometry(2*length+1,3*radius,1),new THREE.MeshBasicMaterial({color:13723726,transparent:!0,opacity:.13}))).position.z=.5*a-2.5,group.add(e)}(),(renderer=new THREE.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),renderer.setSize(canvassize,canvassize),renderer.setClearColor("#d1684e"),$wrap.appendChild(renderer.domElement),$body.addEventListener("mousedown",start,!1),$body.addEventListener("touchstart",start,!1),$body.addEventListener("mouseup",back,!1),$body.addEventListener("touchend",back,!1),animate();